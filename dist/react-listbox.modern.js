import t,{Component as e}from"react";const s=t.createContext();class i extends e{constructor(t){super(t),this.getActiveDescendant=()=>{const[,t]=this.state.optionIds.find(([t])=>t===this.state.activeItem)||[null,null];return t},this.registerOptionId=(t,e)=>{this.unregisterOptionId(t),this.setState(s=>({optionIds:[...s.optionIds,[t,e]]}))},this.unregisterOptionId=t=>{this.setState(e=>({optionIds:e.optionIds.filter(([e])=>e!==t)}))},this.type=t=>{this.setState(e=>({typeahead:e.typeahead.concat(t)}),()=>{const[t]=this.state.optionRefs.find(([,t])=>t.innerText.toLowerCase().startsWith(this.state.typeahead.toLowerCase()))||[null];null!==t&&this.focus(t),this.clearTypeahead()})},this.clearTypeahead=()=>{setTimeout(()=>{this.setState({typeahead:""})},500)},this.registerOptionRef=(t,e)=>{this.unregisterOptionRef(t),this.setState(s=>({optionRefs:[...s.optionRefs,[t,e]]}))},this.unregisterOptionRef=t=>{this.setState(e=>({optionRefs:e.optionRefs.filter(([e])=>e!==t)}))},this.toggle=()=>{this.state.isOpen?this.close():this.open()},this.open=()=>{this.setState({isOpen:!0},()=>{setTimeout(()=>{this.state.listboxListRef&&(this.focus(this.props.value),setTimeout(()=>{this.state.listboxListRef.focus()},5))},10)})},this.close=()=>{this.setState({isOpen:!1},()=>{this.state.listboxButtonRef.focus()})},this.select=t=>{this.props.onChange(t),setTimeout(()=>{this.close()},5)},this.focus=t=>{this.setState({activeItem:t},()=>{null!==t&&this.state.listboxListRef.children[this.state.values.indexOf(this.state.activeItem)].scrollIntoView({block:"nearest"})})},this.setListboxButtonRef=t=>{this.setState({listboxButtonRef:t})},this.setListboxListRef=t=>{this.setState({listboxListRef:t})},this.setButtonId=t=>{this.setState({buttonId:t})},this.setLabelId=t=>{this.setState({labelId:t})},this.setValues=t=>{this.setState({values:t})},this.setActiveItem=t=>{this.setState({activeItem:t})},this.state={typeahead:"",listboxButtonRef:null,listboxListRef:null,isOpen:!1,activeItem:this.props.value,values:null,labelId:null,buttonId:null,optionIds:[],optionRefs:[]}}render(){const{children:t,className:e}=this.props,{isOpen:i}=this.state;return h(s.Provider,{value:{getActiveDescendant:this.getActiveDescendant,registerOptionId:this.registerOptionId,unregisterOptionId:this.unregisterOptionId,registerOptionRef:this.registerOptionRef,unregisterOptionRef:this.unregisterOptionRef,toggle:this.toggle,open:this.open,close:this.close,select:this.select,focus:this.focus,clearTypeahead:this.clearTypeahead,typeahead:this.state.typeahead,type:this.type,setListboxListRef:this.setListboxListRef,setListboxButtonRef:this.setListboxButtonRef,listboxButtonRef:this.state.listboxButtonRef,listboxListRef:this.state.listboxListRef,isOpen:this.state.isOpen,activeItem:this.state.activeItem,setActiveItem:this.setActiveItem,values:this.state.values,setValues:this.setValues,labelId:this.state.labelId,setLabelId:this.setLabelId,buttonId:this.state.buttonId,setButtonId:this.setButtonId,props:this.props}},h("div",{className:e},"function"==typeof t?t({isOpen:i}):t))}}let o=0;const n=()=>"tailwind-ui-listbox-id-"+ ++o;class a extends e{constructor(t){super(t),this.focus=()=>this.setState({isFocused:!0}),this.blur=()=>this.setState({isFocused:!1}),this.state={id:n(),isFocused:!1}}componentDidMount(){this.context.setButtonId(this.state.id),this.context.setListboxButtonRef(this.ownRef)}render(){const{children:t,className:e}=this.props,{isFocused:s}=this.state;return h("button",Object.assign({"aria-haspopup":"listbox","aria-labelledby":`${this.context.labelId} ${this.state.id}`,className:e,id:this.state.id,onBlur:this.blur,onClick:this.context.toggle,onFocus:this.focus,ref:t=>this.ownRef=t,type:"button"},this.context.isOpen?{"aria-expanded":"true"}:{}),"function"==typeof t?t({isFocused:s}):t)}}a.contextType=s;class l extends e{constructor(t){super(t),this.state={id:n()}}componentDidMount(){this.context.setLabelId(this.state.id)}render(){const{children:t,className:e}=this.props;return h("span",{className:e,id:this.state.id},t)}}l.contextType=s;class c extends e{constructor(t){super(t),this.handleBlur=t=>{t.relatedTarget!==this.context.listboxButtonRef&&this.context.close()},this.handleKeydown=t=>{const e=this.state.values.indexOf(this.context.activeItem);let s;switch(t.key){case"Esc":case"Escape":t.preventDefault(),this.context.close();break;case"Tab":t.preventDefault();break;case"Up":case"ArrowUp":t.preventDefault(),s=e-1<0?this.state.values.length-1:e-1,this.context.focus(this.state.values[s]);break;case"Down":case"ArrowDown":t.preventDefault(),s=e+1>this.state.values.length-1?0:e+1,this.context.focus(this.state.values[s]);break;case"Spacebar":case" ":t.preventDefault(),""!==this.context.typeahead?this.context.type(" "):this.context.select(this.context.activeItem||this.context.props);break;case"Enter":t.preventDefault(),this.context.select(this.context.activeItem||this.context.props);break;default:if(!("string"==typeof(i=t.key)||i instanceof String)||1!==t.key.length)return;return t.preventDefault(),void this.context.type(t.key)}var i},this.handleMouseLeave=()=>{this.context.setActiveItem(null)},this.state={focusedIndex:null,values:null}}componentDidMount(){this.context.setListboxListRef(this.ownRef);const t=this.props.children.map(t=>t.props.value);this.setState({values:t},()=>{this.context.setValues(t)})}render(){const{children:t,className:e}=this.props;return h("ul",{"aria-activedescendant":this.context.getActiveDescendant(),"aria-labelledby":this.context.props.labelledby,className:e,onBlur:this.handleBlur,onKeyDown:this.handleKeydown,onMouseLeave:this.handleMouseLeave,ref:t=>this.ownRef=t,role:"listbox",tabIndex:-1},t)}}c.contextType=s;class r extends e{constructor(t){super(t),this.handleClick=()=>{this.context.select(this.props.value)},this.handleMouseMove=()=>{this.context.activeItem!==this.props.value&&this.context.setActiveItem(this.props.value)},this.state={id:n()}}componentDidMount(){this.context.registerOptionRef(this.props.value,this.ownRef),this.context.registerOptionId(this.props.value,this.state.id)}componentWillUnmount(){this.context.unregisterOptionId(this.props.value),this.context.unregisterOptionRef(this.props.value)}render(){const{children:t,className:e}=this.props,s=this.context.activeItem===this.props.value,i=this.context.props.value===this.props.value;return h("li",Object.assign({className:e,id:this.state.id,onClick:this.handleClick,onMouseMove:this.handleMouseMove,ref:t=>this.ownRef=t,role:"option"},i?{"aria-selected":!0}:{}),"function"==typeof t?t({isSelected:i,isActive:s}):t)}}r.contextType=s;export{i as Listbox,a as ListboxButton,l as ListboxLabel,c as ListboxList,r as ListboxOption};
//# sourceMappingURL=react-listbox.modern.js.map
